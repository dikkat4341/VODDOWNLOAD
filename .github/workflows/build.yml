name: Build VOD-Downloader EXE

on: 
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Set up Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests tqdm pyinstaller
      
      - name: Verify Installation
        run: |
          python -c "import requests; print(f'requests: {requests.__version__}')"
          python -c "import tqdm; print(f'tqdm: {tqdm.__version__}')"
          python -c "import PyInstaller; print(f'PyInstaller: {PyInstaller.__version__}')"
      
      - name: Build EXE with PyInstaller
        run: |
          pyinstaller --onefile --console --name "VOD_Downloader" --add-data "user_agents.txt;." --hidden-import=tqdm --hidden-import=requests --hidden-import=urllib3 --hidden-import=certifi --icon=NONE VOD-Downloader.py
        shell: cmd
      
      - name: Verify EXE Build
        run: |
          if (Test-Path "dist/VOD_Downloader.exe") {
            $size = (Get-Item "dist/VOD_Downloader.exe").Length / 1MB
            Write-Host "âœ… EXE baÅŸarÄ±yla oluÅŸturuldu!"
            Write-Host "ğŸ“¦ Dosya Boyutu: $([math]::Round($size, 2)) MB"
            Write-Host "ğŸ“‚ Konum: dist/VOD_Downloader.exe"
          } else {
            Write-Host "âŒ EXE dosyasÄ± bulunamadÄ±!"
            exit 1
          }
        shell: pwsh
      
      - name: Create README for Release
        run: |
          @"
          # VOD Downloader Pro + Auto Turkey Proxy
          
          ## ğŸ“¦ Ä°ndirme TalimatlarÄ±
          
          1. **VOD_Downloader.exe** dosyasÄ±nÄ± indirin
          2. Ã‡ift tÄ±klayarak Ã§alÄ±ÅŸtÄ±rÄ±n
          3. Ä°lk baÅŸlatmada 1-2 dakika bekleyin (Proxy havuzu oluÅŸturuluyor)
          
          ## âš™ï¸ Sistem Gereksinimleri
          
          - Windows 10/11 (64-bit)
          - Ä°nternet BaÄŸlantÄ±sÄ±
          - En az 50MB boÅŸ alan
          
          ## ğŸš€ KullanÄ±m
          
          ### Ä°lk Ã‡alÄ±ÅŸtÄ±rma:
          1. EXE'yi Ã§alÄ±ÅŸtÄ±rÄ±n
          2. Otomatik olarak 30+ TÃ¼rk proxy toplanacak
          3. Ana menÃ¼ aÃ§Ä±lacak
          
          ### M3U Ä°ndirme:
          1. MenÃ¼den **1** seÃ§in
          2. M3U URL'sini girin
          3. Kategori seÃ§in
          4. Ä°ndirme otomatik baÅŸlar (TÃ¼rk proxy ile)
          
          ## ğŸ“ OluÅŸan Dosyalar
          
          Program Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda bu dosyalar oluÅŸur:
          - **user_agents.txt** - 40 User-Agent listesi
          - **turkey_proxies_cache.json** - Proxy Ã¶nbelleÄŸi (1 saat)
          - **Downloads/** - Ä°ndirilen dosyalar
          
          ## ğŸ”§ Ã–zellikler
          
          - âœ… Otomatik TÃ¼rkiye Proxy (30+ aktif)
          - âœ… AkÄ±llÄ± proxy rotasyonu
          - âœ… BaÅŸarÄ±sÄ±z proxy'leri otomatik temizleme
          - âœ… TÃ¼rkÃ§e karakter dÃ¼zeltme
          - âœ… Kategori bazlÄ± indirme
          - âœ… Devam ettirilebilir indirmeler
          - âœ… DetaylÄ± ilerleme Ã§ubuÄŸu
          
          ## âš ï¸ Sorun Giderme
          
          **"Yeterli proxy bulunamadÄ±" hatasÄ±:**
          - Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin
          - VPN kapalÄ± olmalÄ±
          - Proxy olmadan devam edebilirsiniz (E tuÅŸu)
          
          **"requests kÃ¼tÃ¼phanesi bulunamadÄ±" hatasÄ±:**
          - Bu hatayÄ± almamalÄ±sÄ±nÄ±z (EXE'ye gÃ¶mÃ¼lÃ¼)
          - AlÄ±yorsanÄ±z, EXE bozuk olabilir - yeniden indirin
          
          **Ä°ndirme hatalarÄ±:**
          - MenÃ¼ 6 â†’ Proxy havuzunu yenileyin
          - FarklÄ± kategori deneyin
          
          ## ğŸ“Š Proxy Sistemi
          
          - **Otomatik toplama:** 5 farklÄ± kaynaktan
          - **Lokasyon filtresi:** Sadece TÃ¼rkiye
          - **HÄ±z sÄ±ralamasÄ±:** En hÄ±zlÄ± proxy'ler Ã¶ncelikli
          - **Otomatik yenileme:** Havuz 10'un altÄ±na dÃ¼ÅŸÃ¼nce
          - **Ä°statistik takibi:** BaÅŸarÄ±/baÅŸarÄ±sÄ±zlÄ±k oranÄ±
          
          ## ğŸ’¡ Ä°puÃ§larÄ±
          
          - Ä°lk baÅŸlatma en uzun sÃ¼rendir (proxy toplama)
          - Cache varsa sonraki baÅŸlatmalar Ã§ok hÄ±zlÄ±
          - "TÃ¼mÃ¼nÃ¼ Ä°ndir" dikkatli kullanÄ±n (onay sorar)
          - MenÃ¼ 6'dan proxy durumunu kontrol edebilirsiniz
          
          ## ğŸ†˜ Destek
          
          Sorun yaÅŸÄ±yorsanÄ±z GitHub Issues bÃ¶lÃ¼mÃ¼nden bildirin.
          
          ---
          **Build Tarihi:** $(Get-Date -Format "yyyy-MM-dd HH:mm:ss")
          **Versiyon:** GitHub Actions Auto Build
          "@ | Out-File -FilePath "dist/README.txt" -Encoding UTF8
        shell: pwsh
      
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: VOD-Downloader-Windows-${{ github.run_number }}
          path: |
            dist/VOD_Downloader.exe
            dist/README.txt
          retention-days: 90
      
      - name: Create Release on Tag
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/VOD_Downloader.exe
            dist/README.txt
          body: |
            ## ğŸ‰ VOD Downloader Pro - Release ${{ github.ref_name }}
            
            ### â¬‡ï¸ Ä°ndirme
            **VOD_Downloader.exe** dosyasÄ±nÄ± indirin ve Ã§alÄ±ÅŸtÄ±rÄ±n.
            
            ### âœ¨ Ã–zellikler
            - Otomatik TÃ¼rkiye Proxy Sistemi (30+ aktif)
            - M3U kategori bazlÄ± indirme
            - TÃ¼rkÃ§e karakter dÃ¼zeltme
            - AkÄ±llÄ± proxy rotasyonu
            
            ### ğŸ“ KullanÄ±m
            DetaylÄ± kullanÄ±m iÃ§in **README.txt** dosyasÄ±na bakÄ±n.
            
            ---
            **Build:** GitHub Actions
            **Tarih:** ${{ github.event.head_commit.timestamp }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
